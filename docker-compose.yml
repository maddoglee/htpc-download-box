services:
  nordvpn:
    image: ghcr.io/bubuntux/nordvpn
    container_name: nordvpn
    restart: unless-stopped
    cap_add:
      - NET_ADMIN               # Required
      - NET_RAW                 # Required
    environment:                # Review https://github.com/bubuntux/nordvpn#environment-variables
      - TOKEN=${NORDVPN_TOKEN}
      - CONNECT=Australia    
      - TECHNOLOGY=NordLynx
      - NETWORK=192.168.1.0/24  # So it can be accessed within the local network
    sysctls:
      - net.ipv6.conf.all.disable_ipv6=1  # Recomended if using ipv4 only
    networks:
      - media_net


  qbittorrent:
    image: linuxserver/qbittorrent:arm64v8-latest
    container_name: qbittorrent
    environment:
      - PUID=1000               # Optional
      - PGID=1000               # Optional
      - TZ=Australia/Sydney     # Optional
      - WEBUI_PORT=8080         # When accessing the webui, check the docker logs for the randomly generated password.
      #you also need a reverse proxy to access this if it is in the vpn! I'm using Caddy.
    restart: unless-stopped
    network_mode: "service:nordvpn"
    depends_on:
      - nordvpn
    volumes:
      - ./config/qbittorrent:/config
      - ${DOWNLOADS}/downloads:/downloads
      
# The torrent service would be available at http://localhost:8080/ 
# or anywhere inside of the local network http://192.168.1.xxx:8080
  prowlarr:
    image: linuxserver/prowlarr:latest
    container_name: prowlarr
    restart: unless-stopped
    environment:
      - PUID=${PUID} # default user id, defined in .env
      - PGID=${PGID} # default group id, defined in .env
      - TZ=${TZ} # timezone, defined in .env
    network_mode: "service:nordvpn"
    depends_on:
      - nordvpn
    volumes:
      - ./config/prowlarr:/config
      - /etc/localtime:/etc/localtime:ro
    #ports:
    #  - 9696:9696                # Web UI port

  caddy:
    image: caddy:latest
    container_name: caddy
    restart: unless-stopped
    ports:
      - "8080:8080"
      - "9696:9696"
      - "80:80"
      - "443:443"
    volumes:
      - ./config/caddy/Caddyfile:/etc/caddy/Caddyfile
      - ./config/caddy/data:/data
      - ./config/caddy/config:/config
    networks:
      - media_net
    depends_on:
      - nordvpn


  # jackett:
  #   container_name: jackett
  #   image: linuxserver/jackett:latest
  #   restart: unless-stopped
  #   network_mode: host
  #   environment:
  #     - PUID=${PUID} # default user id, defined in .env
  #     - PGID=${PGID} # default group id, defined in .env
  #     - TZ=${TZ} # timezone, defined in .env
  #   volumes:
  #     - /etc/localtime:/etc/localtime:ro
  #     - ${DOWNLOADS}/torrent-blackhole:/downloads # place where to put .torrent files for manual download
  #     - ./config/jackett:/config # config files

  nzbget:
    container_name: nzbget
    image: linuxserver/nzbget:latest
    restart: unless-stopped
    network_mode: host
    environment:
      - PUID=${PUID} # default user id, defined in .env
      - PGID=${PGID} # default group id, defined in .env
      - TZ=${TZ} # timezone, defined in .env
    volumes:
      - ${DOWNLOADS}/downloads:/downloads # download folder
      - ./config/nzbget:/config # config files

  sonarr:
    container_name: sonarr
    image: linuxserver/sonarr:latest
    restart: unless-stopped
    network_mode: host
    environment:
      - PUID=${PUID} # default user id, defined in .env
      - PGID=${PGID} # default group id, defined in .env
      - TZ=${TZ} # timezone, defined in .env
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./config/sonarr:/config # config files
      - ${MEDIA}/:/videos:/tv # tv shows folder
      - ${DOWNLOADS}/downloads:/downloads # download folder

  radarr:
    container_name: radarr
    image: linuxserver/radarr:latest
    restart: unless-stopped
    network_mode: host
    environment:
      - PUID=${PUID} # default user id, defined in .env
      - PGID=${PGID} # default group id, defined in .env
      - TZ=${TZ} # timezone, defined in .env
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./config/radarr:/config # config files
      - ${MEDIA}/:/videos # movies folder
      - ${DOWNLOADS}/downloads:/downloads # download folder

  bazarr:
    container_name: bazarr
    image: linuxserver/bazarr:latest
    restart: unless-stopped
    network_mode: host
    environment:
      - PUID=${PUID} # default user id, defined in .env
      - PGID=${PGID} # default group id, defined in .env
      - TZ=${TZ} # timezone, defined in .env
      - UMASK_SET=022 #optional
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./config/bazarr:/config # config files
#      - ${MEDIA}/Movies:/movies # movies folder
#      - ${MEDIA}/TV_Shows:/tv # tv shows folder
      - ${MEDIA}/:/videos

  portainer:
    image: portainer/portainer-ce:latest
    container_name: portainer
    restart: unless-stopped
    network_mode: host
    ports:
      - "9000:9000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./config/portainer:/data

networks:
  media_net:
    driver: bridge

# Use host for Sonarr, Radarr, Bazarr, NZBGet — they benefit from LAN access.
# Use media_net for Caddy, Prowlarr, qBittorrent — they need internal DNS and reverse proxying.